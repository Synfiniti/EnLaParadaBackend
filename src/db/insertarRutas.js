import db from './index.js';

const geojson = {
  type: 'FeatureCollection',
  features: [
    {
      type: 'Feature',
      properties: {},
      geometry: {
        coordinates: [
          [-66.91611398045634, 10.508026809490133],
          [-66.91408128620132, 10.507682455112615],
          [-66.91151348301524, 10.507131612910584],
          [-66.90986244954698, 10.506833656249782],
          [-66.90609421162407, 10.506235673786009],
          [-66.90196220453453, 10.505606326754844],
          [-66.89949950474866, 10.505019579009783],
          [-66.89745208067426, 10.504640540796018],
          [-66.89150580760423, 10.504674434210159],
          [-66.88835170265729, 10.504691378454183],
          [-66.8863351404854, 10.504471071203469],
          [-66.88241194146714, 10.503791582593578],
          [-66.88029196585123, 10.503503487625238],
          [-66.87968576261645, 10.503334473451929],
          [-66.87854821472447, 10.502232930789077],
          [-66.87783493579502, 10.50152075696468],
          [-66.87689428668264, 10.501273555945815],
          [-66.87608040884021, 10.501139814629255],
          [-66.87764467718829, 10.497898923826256],
          [-66.87787571897199, 10.497217399541398],
          [-66.87458387566015, 10.496385901452115],
          [-66.86888617473635, 10.49522996401761],
          [-66.86533779422439, 10.494479276491461],
          [-66.86398280336482, 10.493804740755664],
          [-66.86221649372011, 10.492564190109675],
          [-66.86138763382051, 10.492007303952889],
          [-66.86075323293423, 10.492077157364847],
          [-66.85926081146295, 10.491968006807951],
          [-66.85811374372001, 10.49204077385042],
          [-66.85641164319819, 10.492404608802104],
          [-66.85422836948798, 10.493098267343612],
          [-66.85214391305263, 10.494238278199603],
          [-66.8508740229289, 10.494903842417571],
          [-66.84724840109779, 10.495839329377489],
          [-66.84259423406564, 10.497078213158872],
          [-66.83972753472496, 10.49695178895199],
          [-66.83615334015354, 10.495586487620741],
          [-66.83420100735421, 10.494722109921582],
          [-66.83263247592362, 10.49386247025592],
          [-66.83144964894352, 10.493533783870177],
          [-66.82913542224212, 10.491586941962936],
          [-66.82607550027083, 10.488982705712488],
          [-66.82382541168215, 10.486892812578915],
          [-66.82205117121194, 10.485653888013815],
          [-66.82036884668989, 10.48436543109571],
          [-66.81877460162984, 10.482317393541393],
          [-66.8174443756021, 10.480557623311824],
          [-66.81667296670112, 10.479394527616833],
          [-66.81495015349061, 10.47878769334676],
          [-66.81126403685316, 10.478585410824806],
          [-66.8092326600821, 10.478509556407204],
        ],
        type: 'LineString',
      },
    },
  ],
};

const nombreRuta = 'Esq. Carmelita - Petare';
const colorRuta = '#7606FF';
const sentidoRuta = 'ida-vuelta';

const insertarRutaConPuntos = async () => {
  try {
    // Insertar ruta
    const resultRuta = await db.query(
      'INSERT INTO rutas (nombre, color, sentido, activa) VALUES ($1, $2, $3, $4) RETURNING id_ruta',
      [nombreRuta, colorRuta, sentidoRuta, true],
    );
    const idRuta = resultRuta.rows[0].id_ruta;

    // Obtener y transformar coordenadas
    const coordenadas = geojson.features[0].geometry.coordinates;
    const puntos = coordenadas.map(([lng, lat]) => ({ lat, lng }));

    // Insertar puntos con orden
    for (let i = 0; i < puntos.length; i++) {
      const punto = puntos[i];
      await db.query(
        'INSERT INTO puntos_ruta (id_ruta, orden, latitud, longitud) VALUES ($1, $2, $3, $4)',
        [idRuta, i + 1, punto.lat, punto.lng],
      );
    }

    console.log(`Ruta "${nombreRuta}" y sus ${puntos.length} puntos insertados correctamente.`);
    process.exit();
  } catch (error) {
    console.error('Error insertando ruta con puntos:', error);
    process.exit(1);
  }
};

insertarRutaConPuntos();
